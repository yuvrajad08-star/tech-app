<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechArchive Ultimate v2</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --neon: #00ffcc; --bg: #050505; --card: rgba(255,255,255,0.05); }
        body { background: var(--bg); color: #fff; font-family: 'Inter', sans-serif; margin: 0; }
        
        .header { background: rgba(0,0,0,0.8); backdrop-filter: blur(20px); padding: 20px; text-align: center; border-bottom: 1px solid var(--neon); sticky; top:0; z-index:1000; }
        .search-box { width: 90%; max-width: 500px; padding: 12px; border-radius: 25px; border: 1px solid var(--neon); background: #111; color: #fff; margin-top: 10px; }

        #posts-container { padding: 20px; max-width: 800px; margin: auto; }
        .post-card { background: var(--card); border-radius: 20px; overflow: hidden; margin-bottom: 30px; border: 1px solid rgba(0,255,204,0.1); transition: 0.4s; }
        .post-card:hover { transform: translateY(-5px); border-color: var(--neon); }
        .post-img { width: 100%; height: 220px; object-fit: cover; cursor: pointer; }
        
        .post-body { padding: 20px; }
        .post-meta { display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--neon); margin-bottom: 10px; }
        .post-title { font-size: 1.4rem; margin: 0 0 10px 0; color: #fff; }
        .post-excerpt { color: #aaa; line-height: 1.6; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
        
        .btn-row { display: flex; gap: 15px; margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px; }
        .action-btn { background: none; border: none; color: #ccc; cursor: pointer; font-size: 0.9rem; transition: 0.3s; }
        .action-btn:hover { color: var(--neon); }

        /* Full Post Modal */
        .full-post-modal { display: none; position: fixed; inset: 0; background: #000; z-index: 3000; overflow-y: auto; padding: 20px; }
        .close-post { position: fixed; top: 20px; right: 20px; font-size: 30px; color: var(--neon); cursor: pointer; }

        /* Admin/Floating Buttons */
        .admin-btn { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: var(--neon); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #000; box-shadow: 0 0 20px var(--neon); cursor: pointer; z-index: 2000; }
    </style>
</head>
<body>

    <div class="header">
        <h1 style="margin:0; letter-spacing: 3px;">TECH_LAB_ULTRA</h1>
        <input type="text" id="searchInput" class="search-box" placeholder="Search technology..." oninput="searchPosts()">
    </div>

    <div id="posts-container"></div>

    <div class="admin-btn" onclick="document.getElementById('adminModal').style.display='flex'"><i class="fas fa-plus"></i></div>

    <div id="postView" class="full-post-modal">
        <span class="close-post" onclick="document.getElementById('postView').style.display='none'">&times;</span>
        <div id="fullContent" style="max-width: 700px; margin: 50px auto;"></div>
    </div>

    <div id="adminModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:4000; align-items:center; justify-content:center; padding:20px;">
        <div style="background:#111; padding:25px; border-radius:20px; border:1px solid var(--neon); width:100%; max-width:450px;">
            <h3 style="color:var(--neon); margin-top:0;">Secure Entry</h3>
            <input type="password" id="pin" placeholder="Admin PIN" style="width:100%; padding:10px; margin:10px 0; background:#222; border:1px solid #444; color:#fff;">
            <input type="text" id="title" placeholder="Title" style="width:100%; padding:10px; margin:10px 0; background:#222; border:1px solid #444; color:#fff;">
            <input type="text" id="img" placeholder="Image URL" style="width:100%; padding:10px; margin:10px 0; background:#222; border:1px solid #444; color:#fff;">
            <textarea id="cont" rows="5" placeholder="Content..." style="width:100%; padding:10px; margin:10px 0; background:#222; border:1px solid #444; color:#fff;"></textarea>
            <button onclick="submitPost()" style="width:100%; padding:12px; background:var(--neon); border:none; border-radius:8px; font-weight:bold; cursor:pointer;">PUBLISH</button>
            <button onclick="document.getElementById('adminModal').style.display='none'" style="width:100%; background:none; color:#666; border:none; margin-top:10px; cursor:pointer;">Cancel</button>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://qghflbvolhhelmkuauas.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFnaGZsYnZvbGhoZWxta3VhdWFzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAyNDAxMjUsImV4cCI6MjA4NTgxNjEyNX0.xWPafcpI45AKyxX4pwgkvXINbpzwCClnNMOHgziE3eo';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function fetchPosts() {
            const { data, error } = await _supabase.from('posts').select('*').order('created_at', { ascending: false });
            if (error) return;
            render(data);
        }

        function render(data) {
            const container = document.getElementById('posts-container');
            container.innerHTML = data.map(post => `
                <div class="post-card">
                    ${post.image_url ? `<img src="${post.image_url}" class="post-img" onclick="viewPost(${post.id})">` : ''}
                    <div class="post-body">
                        <div class="post-meta">
                            <span><i class="fas fa-eye"></i> ${post.views || 0}</span>
                            <span><i class="fas fa-calendar"></i> ${new Date(post.created_at).toLocaleDateString()}</span>
                        </div>
                        <h2 class="post-title">${post.title}</h2>
                        <div class="post-excerpt">${post.content}</div>
                        <div class="btn-row">
                            <button class="action-btn" onclick="viewPost(${post.id})"><i class="fas fa-book-open"></i> Read More</button>
                            <button class="action-btn" onclick="likePost(${post.id}, ${post.likes})"><i class="fas fa-heart"></i> ${post.likes || 0}</button>
                            <button class="action-btn" onclick="sharePost('${post.title}')"><i class="fas fa-share-alt"></i> Share</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function viewPost(id) {
            const { data } = await _supabase.from('posts').select('*').eq('id', id).single();
            // Update View Count
            await _supabase.from('posts').update({ views: (data.views || 0) + 1 }).eq('id', id);
            
            document.getElementById('postView').style.display = 'block';
            document.getElementById('fullContent').innerHTML = `
                <img src="${data.image_url}" style="width:100%; border-radius:15px; margin-bottom:20px;">
                <h1 style="color:var(--neon)">${data.title}</h1>
                <p style="font-size:1.1rem; line-height:1.8; color:#eee; white-space:pre-wrap;">${data.content}</p>
            `;
            fetchPosts(); // Refresh views on main page
        }

        async function likePost(id, currentLikes) {
            await _supabase.from('posts').update({ likes: (currentLikes || 0) + 1 }).eq('id', id);
            fetchPosts();
        }

        function sharePost(title) {
            const text = `Check out this post: ${title} \n\nShared from TechArchive`;
            window.open(`https://t.me/share/url?url=${window.location.href}&text=${encodeURIComponent(text)}`);
        }

        async function submitPost() {
            if (document.getElementById('pin').value !== "1234") return alert("Wrong PIN!");
            const post = {
                title: document.getElementById('title').value,
                content: document.getElementById('cont').value,
                image_url: document.getElementById('img').value
            };
            const { error } = await _supabase.from('posts').insert([post]);
            if (!error) { location.reload(); }
        }

        fetchPosts();
    </script>
</body>
</html>
